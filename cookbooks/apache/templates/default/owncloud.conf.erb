<VirtualHost *:80>
    ServerName <%= @hostname %>
    ServerAlias <%= node[:fqdn] %>
    <IfModule mod_rewrite.c>
      RewriteEngine On
      RewriteCond %{HTTPS} off
      RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
    </IfModule>
</VirtualHost>
<VirtualHost *:443>
    ServerName <%= @hostname %>
    ServerAlias <%= node[:fqdn] %>
    SSLEngine On
    SSLCertificateFile "/usr/local/etc/apache22/ssl.cert"
    SSLCertificateKeyFile "/usr/local/etc/apache22/ssl.key"

    DocumentRoot <%= @docroot %>
    <Directory "<%= @docroot %>">
      Options None
      Options +FollowSymlinks
      AllowOverride All
      Order allow,deny
      Allow from all
    </Directory>

  CustomLog /var/log/httpd/<%= @hostname %>-access.log combined
  ErrorLog /var/log/httpd/<%= @hostname %>-error.log

</VirtualHost>
